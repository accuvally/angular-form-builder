(function(){var l,d,c;l=angular.module("builder.controller",["builder.provider"]);d=function(a,b){var e,h;for(e in a)h=a[e],"$$hashKey"!==e&&(b[e]=h)};c=function(a,b){var e;e=b.get("$builder");a.setupScope=function(b){d(b,a);a.optionsText=b.options.join("\n");a.$watch("[label, description, placeholder, required, options, validation]",function(){b.label=a.label;b.description=a.description;b.placeholder=a.placeholder;b.required=a.required;b.options=a.options;return b.validation=a.validation},!0);a.$watch("optionsText",
function(b){var e,h,c,m;c=b.split("\n");m=[];e=0;for(h=c.length;e<h;e++)b=c[e],0<b.length&&m.push(b);a.options=m;return a.inputText=a.options[0]});return a.validationOptions=e.components[b.component].validationOptions};return a.data={model:null,backup:function(){return this.model={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText,validation:a.validation}},rollback:function(){if(this.model)return a.label=this.model.label,a.description=this.model.description,
a.placeholder=this.model.placeholder,a.required=this.model.required,a.optionsText=this.model.optionsText,a.validation=this.model.validation}}};c.$inject=["$scope","$injector"];l.controller("fbFormObjectEditableController",c);c=function(a,b){var e;e=b.get("$builder");a.selectGroup=function(b,c){var f,g,d,m;null!=b&&b.preventDefault();a.activeGroup=c;a.components=[];d=e.components;m=[];for(g in d)f=d[g],f.group===c&&m.push(a.components.push(f));return m};a.groups=e.groups;a.activeGroup=a.groups[0];
a.allComponents=e.components;return a.$watch("allComponents",function(){return a.selectGroup(null,a.activeGroup)})};c.$inject=["$scope","$injector"];l.controller("fbComponentsController",c);c=function(a){return a.copyObjectToScope=function(b){return d(b,a)}};c.$inject=["$scope"];l.controller("fbComponentController",c);c=function(a,b){var e,c;e=b.get("$builder");c=b.get("$timeout");return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);return c(function(){return a.$broadcast(e.broadcastChannel.updateInput)})},
!0)};c.$inject=["$scope","$injector"];l.controller("fbFormController",c);c=function(a,b){b.get("$builder");a.copyObjectToScope=function(b){return d(b,a)};return a.updateInput=function(b){return a.$parent.input.splice(a.$index,1,{id:a.formObject.id,label:a.formObject.label,value:null!=b?b:[]})}};c.$inject=["$scope","$injector"];l.controller("fbFormObjectController",c)}).call(this);
(function(){var l,d;l=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]);d=function(c){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(a,b,e){var h,k,f,g,d;h=c.get("$builder");k=c.get("$drag");a.formName=e.fbBuilder;null==(g=h.forms)[d=a.formName]&&(g[d]=[]);a.formObjects=h.forms[a.formName];
f=!0;$(b).addClass("fb-builder");return k.droppable($(b),{move:function(e){var c,h,k,g,d,n;f&&($("div.fb-form-object-editable").popover("hide"),f=!1);h=$(b).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===h.length)0===$(b).find(".fb-form-object-editable.empty").length&&$(b).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{g=[];g.push(-1E3);k=d=0;for(n=h.length-1;d<=n;k=d+=1)c=$(h[k]),k=c.offset(),c=c.height(),g.push(k.top+c/2);g.push(g[g.length-
1]+1E3);d=-1;for(k=n=a.formObjects.length-1;0<=n;k=n+=-1)if(!a.formObjects[k].editable){d=k;break}k=d=0<=d?d+2:1;for(n=g.length-1;d<=n;k=d+=1)if(e.pageY>g[k-1]&&e.pageY<=g[k]){$(b).find(".empty").remove();e=$("<div class='fb-form-object-editable empty'></div>");k-1<h.length?e.insertBefore($(h[k-1])):e.insertAfter($(h[k-2]));break}}},out:function(){f&&($("div.fb-form-object-editable").popover("hide"),f=!1);return $(b).find(".empty").remove()},up:function(c,g,d){f=!0;if(k.isMouseMoved())return g||"drag"!==
d.mode?g&&("mirror"===d.mode&&h.insertFormObject(a.formName,$(b).find(".empty").index(".fb-form-object-editable"),{component:d.object.componentName}),"drag"===d.mode&&(g=d.object.formObject.index,c=$(b).find(".empty").index(".fb-form-object-editable"),g<c&&c--,h.updateFormObjectIndex(a.formName,g,c))):(c=d.object.formObject,h.removeFormObject(e.fbBuilder,c.index)),$(b).find(".empty").remove();$(b).find(".empty").remove()}})}}};d.$inject=["$injector"];l.directive("fbBuilder",d);d=function(c){return{restrict:"A",
controller:"fbFormObjectEditableController",link:function(a,b,e){var h,k,d,g,n,m,p,r;g=c.get("$builder");m=c.get("$drag");d=c.get("$parse");n=c.get("$compile");p=c.get("$validator");d=d(e.fbFormObjectEditable)(a);e=g.components[d.component];a.setupScope(d);r=n(e.template)(a);$(b).append(r);$(b).on("click",function(){return!1});if(d.editable)return m.draggable($(b),{object:{formObject:d}}),h="fb-"+Math.random().toString().substr(2),k=!1,d=null,d=e.popoverTemplate,d=$(d).addClass(h),a.popover={save:function(e){e.preventDefault();
p.validate(a).success(function(){k=!0;return $(b).popover("hide")})},remove:function(e){e.preventDefault();g.removeFormObject(a.formName,a.$index);$(b).popover("hide")},shown:function(){a.data.backup();return k=!1},cancel:function(e){a.data.rollback();e&&(e.preventDefault(),$(b).popover("hide"))}},d=n(d)(a),$(b).addClass(h),$(b).popover({html:!0,title:e.label,content:d,container:"body"}),$(b).on("show.bs.popover",function(){var a,e;if(m.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+
h+")").popover("hide");a=$("form."+h).closest(".popover");if(0<a.length)return e=$(b).offset().top+$(b).height()/2,e-=a.height()/2,a.css({position:"absolute",top:e}),a.show(),setTimeout(function(){a.addClass("in");return $(b).triggerHandler("shown.bs.popover")},0),!1}),$(b).on("shown.bs.popover",function(){$(".popover ."+h+" input:first").select();a.$apply(function(){return a.popover.shown()})}),$(b).on("hide.bs.popover",function(){var b;b=$("form."+h).closest(".popover");k||(a.$$phase?a.popover.cancel():
a.$apply(function(){return a.popover.cancel()}));b.removeClass("in");setTimeout(function(){return b.hide()},300);return!1})}}};d.$inject=["$injector"];l.directive("fbFormObjectEditable",d);l.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});d=function(c){return{restrict:"A",controller:"fbComponentController",link:function(a,b,e){var d,k,f;c.get("$builder");k=c.get("$drag");f=c.get("$parse");d=c.get("$compile");e=f(e.fbComponent)(a);a.copyObjectToScope(e);k.draggable($(b),{mode:"mirror",defer:!1,object:{componentName:e.name}});a=d(e.template)(a);return $(b).append(a)}}};d.$inject=["$injector"];l.directive("fbComponent",d);d=function(c){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},
template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object">\n</div>',controller:"fbFormController",link:function(a,b,e){b=c.get("$builder");a.formName=e.fbForm;return a.form=b.forms[a.formName]}}};d.$inject=["$injector"];l.directive("fbForm",d);d=function(c){return{restrict:"A",controller:"fbFormObjectController",link:function(a,b,e){var d,k,f;d=c.get("$builder");k=c.get("$compile");f=c.get("$parse");a.formObject=f(e.fbFormObject)(a);f=d.components[a.formObject.component];
a.$on(d.broadcastChannel.updateInput,function(){var b;return a.updateInput([null!=(b=a.inputText)?b:""])});f.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(b,e){var c,d;if(b!==e){c=[];for(d in a.inputArray)a.inputArray[d]&&c.push(a.options[d]);return a.updateInput(c)}},!0));a.$watch("inputText",function(b){return a.updateInput([b])});a.$watch(e.fbFormObject,function(){return a.copyObjectToScope(a.formObject)},!0);e=$(f.template);e.find("[ng-model='inputText']").attr({validator:"{{validation}}",
"validator-error":"{{errorMessage}}"});k=k(e)(a);$(b).append(k);if(!f.arrayToText&&0<a.formObject.options.length)return a.inputText=a.formObject.options[0]}}};d.$inject=["$injector"];l.directive("fbFormObject",d)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var l,d,c,a=this;d=l=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return a.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(b){var e,c,d;a.mouseMoved=!1;d=a.hooks.down;for(c in d)e=d[c],e(b)});$(document).on("mousemove",function(b){var e,c,d;a.mouseMoved=!0;d=a.hooks.move;
for(c in d)e=d[c],e(b)});return $(document).on("mouseup",function(b){var e,c,d;d=a.hooks.up;for(c in d)e=d[c],e(b)})});this.currentId=0;this.getNewId=function(){return""+a.currentId++};this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,e,c,d,f){return-d*(e/=f)*(e-2)+c}})};this.setupProviders=function(a){l=a;return d=l.get("$rootScope")};this.isHover=function(a,e){var c,d,f,g,n,m,p;m=a.offset();p=e.offset();f=a.width();g=a.height();c=e.width();d=e.height();n={x:!1,
y:!1};n.x=m.left>p.left&&m.left<p.left+c;n.x=n.x||m.left+f>p.left&&m.left+f<p.left+c;if(!n)return!1;n.y=m.top>p.top&&m.top<p.top+d;n.y=n.y||m.top+g>p.top&&m.top+g<p.top+d;return n.x&&n.y};c=function(a,e){return setTimeout(function(){return e()},a)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(){a.autoScroll.scrolling=!0;return a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?
($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1},start:function(b){if(50>b.clientY){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else if(b.clientY>$(window).innerHeight()-50){if(a.autoScroll.up=!1,a.autoScroll.down=!0,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else return a.autoScroll.up=!1,a.autoScroll.down=!1}};this.dragMirrorMode=
function(b,e,c){var d;null==e&&(e=!0);d={id:a.getNewId(),mode:"mirror",maternal:b[0],element:null,object:c};b.on("mousedown",function(c){var g;c.preventDefault();g=b.clone();d.element=g[0];g.addClass("fb-draggable form-horizontal prepare-dragging");a.hooks.move.drag=function(e,c){var h,f,l,q;if(g.hasClass("prepare-dragging")&&(g.css({width:b.width(),height:b.height()}),g.removeClass("prepare-dragging"),g.addClass("dragging"),c))return;g.offset({left:e.pageX-g.width()/2,top:e.pageY-g.height()/2});
a.autoScroll.start(e);l=a.data.droppables;q=[];for(f in l)h=l[f],a.isHover(g,$(h.element))?q.push(h.move(e,d)):q.push(h.out(e,d));return q};a.hooks.up.drag=function(b){var e,c,h,f;f=a.data.droppables;for(c in f)e=f[c],h=a.isHover(g,$(e.element)),e.up(b,h,d);delete a.hooks.move.drag;delete a.hooks.up.drag;d.element=null;return g.remove()};$("body").append(g);if(!e)return a.hooks.move.drag(c,e)});return d};this.dragDragMode=function(b,e,c){var d;null==e&&(e=!0);d={id:a.getNewId(),mode:"drag",maternal:null,
element:b[0],object:c};b.addClass("fb-draggable");b.on("mousedown",function(c){c.preventDefault();if(!b.hasClass("dragging")&&(b.addClass("prepare-dragging"),a.hooks.move.drag=function(e,c){var h,f,l;if(b.hasClass("prepare-dragging")&&(b.css({width:b.width(),height:b.height()}),b.removeClass("prepare-dragging"),b.addClass("dragging"),c))return;b.offset({left:e.pageX-b.width()/2,top:e.pageY-b.height()/2});a.autoScroll.start(e);l=a.data.droppables;for(f in l)h=l[f],a.isHover(b,$(h.element))?h.move(e,
d):h.out(e,d)},a.hooks.up.drag=function(e){var c,h,f,l;l=a.data.droppables;for(h in l)c=l[h],f=a.isHover(b,$(c.element)),c.up(e,f,d);delete a.hooks.move.drag;delete a.hooks.up.drag;b.css({width:"",height:"",left:"",top:""});return b.removeClass("dragging defer-dragging")},!e))return a.hooks.move.drag(c,e)});return d};this.dropMode=function(b,e){return{id:a.getNewId(),element:b[0],move:function(a,b){return d.$apply(function(){return"function"===typeof e.move?e.move(a,b):void 0})},up:function(a,b,c){return d.$apply(function(){return"function"===
typeof e.up?e.up(a,b,c):void 0})},out:function(a,b){return d.$apply(function(){return"function"===typeof e.out?e.out(a,b):void 0})}}};this.draggable=function(b,e){var c,d,f,g;null==e&&(e={});d=[];if("mirror"===e.mode)for(f=0,g=b.length;f<g;f++)c=b[f],c=a.dragMirrorMode($(c),e.defer,e.object),d.push(c.id),a.data.draggables[c.id]=c;else for(f=0,g=b.length;f<g;f++)c=b[f],c=a.dragDragMode($(c),e.defer,e.object),d.push(c.id),a.data.draggables[c.id]=c;return d};this.droppable=function(b,c){var d,k,f,g;
null==c&&(c={});k=[];f=0;for(g=b.length;f<g;f++)d=b[f],d=a.dropMode($(d),c),k.push(d),a.data.droppables[d.id]=d;return k};this.get=function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var l=[].indexOf||function(d){for(var c=0,a=this.length;c<a;c++)if(c in this&&this[c]===d)return c;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var d=this;this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substr(1)};this.getNewGuid=function(){return""+this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+
this.s4()+this.s4()};this.getEmptyGuid=function(){return"00000000-0000-0000-0000-000000000000"};this.convertComponent=function(c,a){var b,e,d,k,f,g,l,m,p,r,s,q;b={name:c,group:null!=(e=a.group)?e:"Default",label:null!=(d=a.label)?d:"",description:null!=(f=a.description)?f:"",placeholder:null!=(g=a.placeholder)?g:"",editable:null!=(l=a.editable)?l:!0,required:null!=(m=a.required)?m:!1,validation:null!=(p=a.validation)?p:"/.*/",validationOptions:null!=(r=a.validationOptions)?r:[],errorMessage:null!=
(s=a.errorMessage)?s:"",options:null!=(q=a.options)?q:[],arrayToText:null!=(k=a.arrayToText)?k:!1,template:a.template,popoverTemplate:a.popoverTemplate};b.template||console.error("The template is empty.");b.popoverTemplate||console.error("The popoverTemplate is empty.");return b};this.convertFormObject=function(c,a){var b,d,h,k,f,g,l,m,p,r,s,q,t,u,v,w;null==a&&(a={});b=this.components[a.component];if(null==b)throw"The component "+a.component+" was not registered.";if(a.id){d=!1;g=this.forms[c];k=
0;for(f=g.length;k<f;k++)if(h=g[k],a.id<=h.id){a.id=this.formsId[c]++;d=!0;break}d||(this.formsId[c]=a.id+1)}return{id:null!=(l=a.id)?l:this.getNewGuid(),component:a.component,editable:null!=(p=a.editable)?p:b.editable,index:null!=(r=a.index)?r:0,label:null!=(s=a.label)?s:b.label,description:null!=(q=a.description)?q:b.description,placeholder:null!=(t=a.placeholder)?t:b.placeholder,options:null!=(u=a.options)?u:b.options,required:null!=(v=a.required)?v:b.required,validation:null!=(w=a.validation)?
w:b.validation,errorMessage:null!=(m=a.errorMessage)?m:b.errorMessage}};this.reindexFormObject=function(c){var a,b,e;c=d.forms[c];a=b=0;for(e=c.length-1;b<=e;a=b+=1)c[a].index=a};this.registerComponent=function(c,a){var b,e;null==a&&(a={});null==d.components[c]?(b=d.convertComponent(c,a),d.components[c]=b,(e=b.group,0>l.call(d.groups,e))&&d.groups.push(b.group)):console.error("The component "+c+" was registered.")};this.addFormObject=function(c,a){null==a&&(a={});return d.insertFormObject(c,d.forms[c].length,
a)};this.insertFormObject=function(c,a,b){var e;null==b&&(b={});null==(e=d.forms)[c]&&(e[c]=[]);a>d.forms[c].length?a=d.forms[c].length:0>a&&(a=0);d.forms[c].splice(a,0,d.convertFormObject(c,b));return d.reindexFormObject(c)};this.removeFormObject=function(c,a){d.forms[c].splice(a,1);return d.reindexFormObject(c)};this.updateFormObjectIndex=function(c,a,b){var e;if(a!==b)return e=d.forms[c],a=e.splice(a,1)[0],e.splice(b,0,a),d.reindexFormObject(c)};this.$get=this.get=function(){return{components:this.components,
groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,updateFormObjectIndex:this.updateFormObjectIndex}}})}).call(this);
