(function(){var g,e,c;g=angular.module("builder.controller",["builder.provider"]);e=function(a,b){var d,l;for(d in a)l=a[d],"$$hashKey"!==d&&(b[d]=l)};c=function(a,b){var d;d=b.get("$builder");a.setupScope=function(b){e(b,a);a.optionsText=b.Options.join("\n");a.$watch("[Label, Description, Placeholder, Required, Options, Validation]",function(){b.Label=a.Label;b.Description=a.Description;b.Placeholder=a.Placeholder;b.Required=a.Required;b.Options=a.Options;return b.Validation=a.Validation},!0);a.$watch("optionsText",
function(b){var d,l,c,h;c=b.split("\n");h=[];d=0;for(l=c.length;d<l;d++)b=c[d],0<b.length&&h.push(b);a.Options=h;return a.inputText=a.Options[0]});return a.validationOptions=d.components[b.Component].validationOptions};return a.data={model:null,backup:function(){return this.model={label:a.Label,description:a.Description,placeholder:a.Placeholder,required:a.Required,optionsText:a.optionsText,validation:a.Validation}},rollback:function(){if(this.model)return a.Label=this.model.label,a.Description=this.model.description,
a.Placeholder=this.model.placeholder,a.Required=this.model.required,a.optionsText=this.model.optionsText,a.Validation=this.model.validation}}};c.$inject=["$scope","$injector"];g.controller("fbFormObjectEditableController",c);c=function(a,b){var d;d=b.get("$builder");a.selectGroup=function(b,f){var c,k,m,h;null!=b&&b.preventDefault();a.activeGroup=f;a.components=[];m=d.components;h=[];for(k in m)c=m[k],c.group===f&&h.push(a.components.push(c));return h};a.groups=d.groups;a.activeGroup=a.groups[0];
a.allComponents=d.components;return a.$watch("allComponents",function(){return a.selectGroup(null,a.activeGroup)})};c.$inject=["$scope","$injector"];g.controller("fbComponentsController",c);c=function(a){return a.copyObjectToScope=function(b){e(b,a);a.Label=a.label;a.Description=a.description;a.Placeholder=a.placeholder;a.Options=a.options;return a.Required=a.required}};c.$inject=["$scope"];g.controller("fbComponentController",c);c=function(a,b){var d,l;d=b.get("$builder");l=b.get("$timeout");null==
a.input&&(a.input=[]);return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);return l(function(){return a.$broadcast(d.broadcastChannel.updateInput)})},!0)};c.$inject=["$scope","$injector"];g.controller("fbFormController",c);c=function(a,b){b.get("$builder");a.copyObjectToScope=function(b){return e(b,a)};return a.updateInput=function(b){return a.$parent.input.splice(a.$index,1,{IdNumber:a.formObject.IdNumber,Label:a.formObject.Label,Value:null!=b?b:[]})}};c.$inject=
["$scope","$injector"];g.controller("fbFormObjectController",c)}).call(this);
(function(){var g,e,c=[].indexOf||function(a){for(var b=0,d=this.length;b<d;b++)if(b in this&&this[b]===a)return b;return-1};g=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]);e=function(a){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(b,d,l){var f,c,k,m,h;f=a.get("$builder");c=
a.get("$drag");b.formName=l.fbBuilder;null==(m=f.forms)[h=b.formName]&&(m[h]=[]);b.formObjects=f.forms[b.formName];k=!0;$(d).addClass("fb-builder");return c.droppable($(d),{move:function(a){var l,c,f,m,h,e;k&&($("div.fb-form-object-editable").popover("hide"),k=!1);c=$(d).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===c.length)0===$(d).find(".fb-form-object-editable.empty").length&&$(d).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{m=[];m.push(-1E3);
f=h=0;for(e=c.length;h<e;f=h+=1)l=$(c[f]),f=l.offset(),l=l.height(),m.push(f.top+l/2);m.push(m[m.length-1]+1E3);h=-1;for(f=e=b.formObjects.length-1;0<=e;f=e+=-1)if(!b.formObjects[f].Editable){h=f;break}f=h=0<=h?h+2:1;for(e=m.length;h<e;f=h+=1)if(a.pageY>m[f-1]&&a.pageY<=m[f]){$(d).find(".empty").remove();a=$("<div class='fb-form-object-editable empty'></div>");f-1<c.length?a.insertBefore($(c[f-1])):a.insertAfter($(c[f-2]));break}}},out:function(){k&&($("div.fb-form-object-editable").popover("hide"),
k=!1);return $(d).find(".empty").remove()},up:function(a,m,h){k=!0;if(c.isMouseMoved())return m||"drag"!==h.mode?m&&("mirror"===h.mode&&(a=$(d).find(".empty").index(".fb-form-object-editable"),0<=a&&f.insertFormObject(b.formName,$(d).find(".empty").index(".fb-form-object-editable"),{Component:h.object.componentName})),"drag"===h.mode&&(a=h.object.formObject.OrderBy,h=$(d).find(".empty").index(".fb-form-object-editable"),a<h&&h--,f.updateFormObjectIndex(b.formName,a,h))):(h=h.object.formObject,h.Editable&&
f.removeFormObject(l.fbBuilder,h.OrderBy)),$(d).find(".empty").remove();$(d).find(".empty").remove()}})}}};e.$inject=["$injector"];g.directive("fbBuilder",e);e=function(a){return{restrict:"A",controller:"fbFormObjectEditableController",link:function(b,d,l){var f,c,k,m,h,e,p,g;m=a.get("$builder");e=a.get("$drag");k=a.get("$parse");h=a.get("$compile");p=a.get("$validator");k=k(l.fbFormObjectEditable)(b);l=m.components[k.Component];b.setupScope(k);g=h(l.template)(b);$(d).append(g);$(d).on("click",function(){return!1});
if(k.Editable)return e.draggable($(d),{object:{formObject:k}}),f="fb-"+Math.random().toString().substr(2),c=!1,k=null,k=l.popoverTemplate,k=$(k).addClass(f),b.popover={save:function(a){a.preventDefault();p.validate(b).success(function(){c=!0;return $(d).popover("hide")})},remove:function(a){a.preventDefault();m.removeFormObject(b.formName,b.$index);$(d).popover("hide")},shown:function(){b.data.backup();return c=!1},cancel:function(a){b.data.rollback();a&&(a.preventDefault(),$(d).popover("hide"))}},
k=h(k)(b),$(d).addClass(f),$(d).popover({html:!0,title:l.label,content:k,container:"body"}),$(d).on("show.bs.popover",function(){var a,b;if(e.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+f+")").popover("hide");a=$("form."+f).closest(".popover");if(0<a.length)return b=$(d).offset().top+$(d).height()/2,b-=a.height()/2,a.css({position:"absolute",top:b}),a.show(),setTimeout(function(){a.addClass("in");return $(d).triggerHandler("shown.bs.popover")},0),!1}),$(d).on("shown.bs.popover",
function(){$(".popover ."+f+" input:first").select();b.$apply(function(){return b.popover.shown()})}),$(d).on("hide.bs.popover",function(){var a;a=$("form."+f).closest(".popover");c||(b.$$phase?b.popover.cancel():b.$apply(function(){return b.popover.cancel()}));a.removeClass("in");setTimeout(function(){return a.hide()},300);return!1})}}};e.$inject=["$injector"];g.directive("fbFormObjectEditable",e);g.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});e=function(a){return{restrict:"A",controller:"fbComponentController",link:function(b,d,c){var f,e,k;a.get("$builder");e=a.get("$drag");k=a.get("$parse");f=a.get("$compile");c=k(c.fbComponent)(b);b.copyObjectToScope(c);e.draggable($(d),{mode:"mirror",defer:!1,object:{componentName:c.name}});b=f(c.template)(b);return $(d).append(b)}}};e.$inject=["$injector"];g.directive("fbComponent",e);e=function(a){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},
template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object"></div>',controller:"fbFormController",link:function(b,d,c){d=a.get("$builder");b.formName=c.fbForm;return b.form=d.forms[c.fbForm]}}};e.$inject=["$injector"];g.directive("fbForm",e);e=function(a){return{restrict:"A",controller:"fbFormObjectController",link:function(b,d,l){var f,e,k;f=a.get("$builder");e=a.get("$compile");k=a.get("$parse");b.formObject=k(l.fbFormObject)(b);k=f.components[b.formObject.Component];
b.$on(f.broadcastChannel.updateInput,function(){var a;return b.updateInput([null!=(a=b.inputText)?a:""])});k.arrayToText?(b.inputArray=[],b.$watch("inputArray",function(a,d){var c,f;if(a!==d){c=[];for(f in b.inputArray)b.inputArray[f]&&c.push(b.Options[f]);return b.updateInput(c)}},!0),b.$parent.$watch("input["+b.$index+"].Value",function(a){var d,f,l,k,e;if(a){1===a.length&&a[0]&&(b.inputText=a[0]);f=b.Options?b.Options.length:0;e=[];for(d=l=0;l<f;d=l+=1)e.push(b.inputArray[d]=(k=b.Options[d],0<=
c.call(a,k)));return e}},!0)):b.$parent.$watch("input["+b.$index+"].Value",function(a,d){if(a!==d&&a[0])return b.inputText=a[0]},!0);b.$watch("inputText",function(a){return b.updateInput([a])});b.$watch(l.fbFormObject,function(){return b.copyObjectToScope(b.formObject)},!0);l=$(k.template);l.find("[ng-model='inputText']").attr({validator:"{{validation}}"});e=e(l)(b);$(d).append(e);if(!k.arrayToText&&0<b.formObject.Options.length)return b.inputText=b.formObject.Options[0]}}};e.$inject=["$injector"];
g.directive("fbFormObject",e)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var g,e,c,a=this;e=g=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return a.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(b){var d,c,f;a.mouseMoved=!1;f=a.hooks.down;for(c in f)d=f[c],d(b)});$(document).on("mousemove",function(b){var d,c,f;a.mouseMoved=!0;f=a.hooks.move;
for(c in f)d=f[c],d(b)});return $(document).on("mouseup",function(b){var d,c,f;f=a.hooks.up;for(c in f)d=f[c],d(b)})});this.currentId=0;this.getNewId=function(){return""+a.currentId++};this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,d,c,f,e){return-f*(d/=e)*(d-2)+c}})};this.setupProviders=function(a){g=a;return e=g.get("$rootScope")};this.isHover=function(a,d){var c,f,e,k,m,h,n;h=a.offset();n=d.offset();e=a.width();k=a.height();c=d.width();f=d.height();m={x:!1,
y:!1};m.x=h.left>n.left&&h.left<n.left+c;m.x=m.x||h.left+e>n.left&&h.left+e<n.left+c;if(!m)return!1;m.y=h.top>n.top&&h.top<n.top+f;m.y=m.y||h.top+k>n.top&&h.top+k<n.top+f;return m.x&&m.y};c=function(a,d){return setTimeout(function(){return d()},a)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(){a.autoScroll.scrolling=!0;return a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?
($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1},start:function(b){if(50>b.clientY){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else if(b.clientY>$(window).innerHeight()-50){if(a.autoScroll.up=!1,a.autoScroll.down=!0,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else return a.autoScroll.up=!1,a.autoScroll.down=!1},stop:function(){a.autoScroll.up=
!1;return a.autoScroll.down=!1}};this.dragMirrorMode=function(b,d,c){var f;null==d&&(d=!0);f={id:a.getNewId(),mode:"mirror",maternal:b[0],element:null,object:c};b.on("mousedown",function(c){var e;c.preventDefault();e=b.clone();f.element=e[0];e.addClass("fb-draggable form-horizontal prepare-dragging");a.hooks.move.drag=function(d,c){var l,r,g,q;if(e.hasClass("prepare-dragging")&&(e.css({width:b.width(),height:b.height()}),e.removeClass("prepare-dragging"),e.addClass("dragging"),c))return;e.offset({left:d.pageX-
e.width()/2,top:d.pageY-e.height()/2});a.autoScroll.start(d);g=a.data.droppables;q=[];for(r in g)l=g[r],a.isHover(e,$(l.element))?q.push(l.move(d,f)):q.push(l.out(d,f));return q};a.hooks.up.drag=function(b){var d,c,l,g;g=a.data.droppables;for(c in g)d=g[c],l=a.isHover(e,$(d.element)),d.up(b,l,f);delete a.hooks.move.drag;delete a.hooks.up.drag;f.element=null;e.remove();return a.autoScroll.stop()};$("body").append(e);if(!d)return a.hooks.move.drag(c,d)});return f};this.dragDragMode=function(b,d,c){var f;
null==d&&(d=!0);f={id:a.getNewId(),mode:"drag",maternal:null,element:b[0],object:c};b.addClass("fb-draggable");b.on("mousedown",function(c){c.preventDefault();if(!b.hasClass("dragging")&&(b.addClass("prepare-dragging"),a.hooks.move.drag=function(d,c){var e,l,g;if(b.hasClass("prepare-dragging")&&(b.css({width:b.width(),height:b.height()}),b.removeClass("prepare-dragging"),b.addClass("dragging"),c))return;b.offset({left:d.pageX-b.width()/2,top:d.pageY-b.height()/2});a.autoScroll.start(d);g=a.data.droppables;
for(l in g)e=g[l],a.isHover(b,$(e.element))?e.move(d,f):e.out(d,f)},a.hooks.up.drag=function(d){var c,e,l,g;g=a.data.droppables;for(e in g)c=g[e],l=a.isHover(b,$(c.element)),c.up(d,l,f);delete a.hooks.move.drag;delete a.hooks.up.drag;b.css({width:"",height:"",left:"",top:""});b.removeClass("dragging defer-dragging");return a.autoScroll.stop()},!d))return a.hooks.move.drag(c,d)});return f};this.dropMode=function(b,d){return{id:a.getNewId(),element:b[0],move:function(a,b){return e.$apply(function(){return"function"===
typeof d.move?d.move(a,b):void 0})},up:function(a,b,c){return e.$apply(function(){return"function"===typeof d.up?d.up(a,b,c):void 0})},out:function(a,b){return e.$apply(function(){return"function"===typeof d.out?d.out(a,b):void 0})}}};this.draggable=function(b,d){var c,e,g,k;null==d&&(d={});e=[];if("mirror"===d.mode)for(g=0,k=b.length;g<k;g++)c=b[g],c=a.dragMirrorMode($(c),d.defer,d.object),e.push(c.id),a.data.draggables[c.id]=c;else for(g=0,k=b.length;g<k;g++)c=b[g],c=a.dragDragMode($(c),d.defer,
d.object),e.push(c.id),a.data.draggables[c.id]=c;return e};this.droppable=function(b,d){var c,e,g,k;null==d&&(d={});e=[];g=0;for(k=b.length;g<k;g++)c=b[g],c=a.dropMode($(c),d),e.push(c),a.data.droppables[c.id]=c;return e};this.get=function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var g=[].indexOf||function(e){for(var c=0,a=this.length;c<a;c++)if(c in this&&this[c]===e)return c;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var e=this;this.version="0.0.0";this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.bleach={toUpperCase:function(c){var a,b,d;b={};for(a in c)d=c[a],b[a.replace(/^\w?/,a.substr(0,1).toUpperCase())]=d;return b},toLowerCase:function(c){var a,b,d;b={};
for(a in c)d=c[a],b[a.replace(/^\w?/,a.substr(0,1).toLowerCase())]=d;return b}};this.convertComponent=function(c,a){var b,d,e,f,g,k,m,h,n,p,s;b={name:c,group:null!=(d=a.group)?d:"Default",label:null!=(e=a.label)?e:"",description:null!=(f=a.description)?f:"",placeholder:null!=(g=a.placeholder)?g:"",editable:null!=(k=a.editable)?k:!0,required:null!=(m=a.required)?m:!1,validation:null!=(h=a.validation)?h:"/.*/",validationOptions:null!=(n=a.validationOptions)?n:[],options:null!=(p=a.options)?p:[],arrayToText:null!=
(s=a.arrayToText)?s:!1,template:a.template,popoverTemplate:a.popoverTemplate};b.template||console.error("The template is empty.");b.popoverTemplate||console.error("The popoverTemplate is empty.");return b};this.convertFormObject=function(c,a){var b,d,e,f,g,k,m,h,n,p;null==a&&(a={});a=this.bleach.toUpperCase(a);b=this.components[a.Component];if(null==b)throw"The component "+a.Component+" was not registered.";return{IdNumber:null!=(d=a.IdNumber)?d:null,Component:a.Component,Editable:null!=(e=a.Editable)?
e:b.editable,OrderBy:null!=(f=a.OrderBy)?f:0,Label:null!=(g=a.Label)?g:b.label,Description:null!=(k=a.Description)?k:b.description,Placeholder:null!=(m=a.Placeholder)?m:b.placeholder,Options:null!=(h=a.Options)?h:b.options,Required:null!=(n=a.Required)?n:b.required,Validation:null!=(p=a.Validation)?p:b.validation}};this.reindexFormObject=function(c){var a,b,d;c=e.forms[c];a=b=0;for(d=c.length;b<d;a=b+=1)c[a].OrderBy=a};this.registerComponent=function(c,a){var b,d;null==a&&(a={});null==e.components[c]?
(b=e.convertComponent(c,a),e.components[c]=b,(d=b.group,0>g.call(e.groups,d))&&e.groups.push(b.group)):console.error("The component "+c+" was registered.")};this.addFormObject=function(c,a){var b;null==a&&(a={});null==(b=e.forms)[c]&&(b[c]=[]);return e.insertFormObject(c,e.forms[c].length,a)};this.insertFormObject=function(c,a,b){var d;null==b&&(b={});null==(d=e.forms)[c]&&(d[c]=[]);a>e.forms[c].length?a=e.forms[c].length:0>a&&(a=0);e.forms[c].splice(a,0,e.convertFormObject(c,b));return e.reindexFormObject(c)};
this.removeFormObject=function(c,a){e.forms[c].splice(a,1);return e.reindexFormObject(c)};this.updateFormObjectIndex=function(c,a,b){var d;if(a!==b)return d=e.forms[c],a=d.splice(a,1)[0],d.splice(b,0,a),e.reindexFormObject(c)};this.$get=this.get=function(){return{version:this.version,components:this.components,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,
updateFormObjectIndex:this.updateFormObjectIndex}}})}).call(this);
