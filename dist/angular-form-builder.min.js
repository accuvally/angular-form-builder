(function(){var h,e,c;h=angular.module("builder.controller",["builder.provider"]);e=function(a,b){var d,f;for(d in a)f=a[d],"$$hashKey"!==d&&(b[d]=f)};c=function(a,b){var d;d=b.get("$builder");a.setupScope=function(b){e(b,a);a.optionsText=b.options.join("\n");a.$watch("[label, description, placeholder, required, options, validation]",function(){b.label=a.label;b.description=a.description;b.placeholder=a.placeholder;b.required=a.required;b.options=a.options;return b.validation=a.validation},!0);a.$watch("optionsText",
function(b){var d,f,c,l;c=b.split("\n");l=[];d=0;for(f=c.length;d<f;d++)b=c[d],0<b.length&&l.push(b);a.options=l;return a.inputText=a.options[0]});return a.validationOptions=d.components[b.component].validationOptions};return a.data={model:null,backup:function(){return this.model={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText,validation:a.validation}},rollback:function(){if(this.model)return a.label=this.model.label,a.description=this.model.description,
a.placeholder=this.model.placeholder,a.required=this.model.required,a.optionsText=this.model.optionsText,a.validation=this.model.validation}}};c.$inject=["$scope","$injector"];h.controller("fbFormObjectEditableController",c);c=function(a,b){var d;d=b.get("$builder");a.selectGroup=function(b,c){var g,k,e,l;null!=b&&b.preventDefault();a.activeGroup=c;a.components=[];e=d.components;l=[];for(k in e)g=e[k],g.group===c&&l.push(a.components.push(g));return l};a.groups=d.groups;a.activeGroup=a.groups[0];
a.allComponents=d.components;return a.$watch("allComponents",function(){return a.selectGroup(null,a.activeGroup)})};c.$inject=["$scope","$injector"];h.controller("fbComponentsController",c);c=function(a){return a.copyObjectToScope=function(b){return e(b,a)}};c.$inject=["$scope"];h.controller("fbComponentController",c);c=function(a,b){var d,c;d=b.get("$builder");c=b.get("$timeout");null==a.input&&(a.input=[]);return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);
return c(function(){return a.$broadcast(d.broadcastChannel.updateInput)})},!0)};c.$inject=["$scope","$injector"];h.controller("fbFormController",c);c=function(a,b){b.get("$builder");a.copyObjectToScope=function(b){return e(b,a)};return a.updateInput=function(b){return a.$parent.input.splice(a.$index,1,{id:a.formObject.id,label:a.formObject.label,value:null!=b?b:[]})}};c.$inject=["$scope","$injector"];h.controller("fbFormObjectController",c)}).call(this);
(function(){var h,e;h=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]);e=function(c){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(a,b,d){var f,m,g,k,e;f=c.get("$builder");m=c.get("$drag");a.formName=d.fbBuilder;null==(k=f.forms)[e=a.formName]&&(k[e]=[]);a.formObjects=f.forms[a.formName];
g=!0;$(b).addClass("fb-builder");return m.droppable($(b),{move:function(a){var d,c,f,m,k,e;g&&($("div.fb-form-object-editable").popover("hide"),g=!1);c=$(b).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===c.length)0===$(b).find(".fb-form-object-editable.empty").length&&$(b).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{m=[];m.push(-1E3);f=k=0;for(e=c.length-1;k<=e;f=k+=1)d=$(c[f]),f=d.offset(),d=d.height(),m.push(f.top+d/2);m.push(m[m.length-
1]+1E3);f=k=1;for(e=m.length-1;k<=e;f=k+=1)if(a.pageY>m[f-1]&&a.pageY<=m[f]){$(b).find(".empty").remove();a=$("<div class='fb-form-object-editable empty'></div>");f-1<c.length?a.insertBefore($(c[f-1])):a.insertAfter($(c[f-2]));break}}},out:function(){g&&($("div.fb-form-object-editable").popover("hide"),g=!1);return $(b).find(".empty").remove()},up:function(c,k,e){g=!0;if(m.isMouseMoved())return k||"drag"!==e.mode?k&&("mirror"===e.mode&&f.insertFormObject(a.formName,$(b).find(".empty").index(".fb-form-object-editable"),
{component:e.object.componentName}),"drag"===e.mode&&(k=e.object.formObject.index,c=$(b).find(".empty").index(".fb-form-object-editable"),k<c&&c--,f.updateFormObjectIndex(a.formName,k,c))):(c=e.object.formObject,c.editable&&f.removeFormObject(d.fbBuilder,c.index)),$(b).find(".empty").remove();$(b).find(".empty").remove()}})}}};e.$inject=["$injector"];h.directive("fbBuilder",e);e=function(c){return{restrict:"A",controller:"fbFormObjectEditableController",link:function(a,b,d){var f,m,g,k,e,l,n,q;k=
c.get("$builder");l=c.get("$drag");g=c.get("$parse");e=c.get("$compile");n=c.get("$validator");g=g(d.fbFormObjectEditable)(a);d=k.components[g.component];a.setupScope(g);q=e(d.template)(a);$(b).append(q);$(b).on("click",function(){return!1});l.draggable($(b),{object:{formObject:g}});if(g.editable)return f="fb-"+Math.random().toString().substr(2),m=!1,g=null,g=d.popoverTemplate,g=$(g).addClass(f),a.popover={save:function(d){d.preventDefault();n.validate(a).success(function(){m=!0;return $(b).popover("hide")})},
remove:function(d){d.preventDefault();k.removeFormObject(a.formName,a.$index);$(b).popover("hide")},shown:function(){a.data.backup();return m=!1},cancel:function(d){a.data.rollback();d&&(d.preventDefault(),$(b).popover("hide"))}},g=e(g)(a),$(b).addClass(f),$(b).popover({html:!0,title:d.label,content:g,container:"body"}),$(b).on("show.bs.popover",function(){var a,d;if(l.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+f+")").popover("hide");a=$("form."+f).closest(".popover");if(0<a.length)return d=
$(b).offset().top+$(b).height()/2,d-=a.height()/2,a.css({position:"absolute",top:d}),a.show(),setTimeout(function(){a.addClass("in");return $(b).triggerHandler("shown.bs.popover")},0),!1}),$(b).on("shown.bs.popover",function(){$(".popover ."+f+" input:first").select();a.$apply(function(){return a.popover.shown()})}),$(b).on("hide.bs.popover",function(){var b;b=$("form."+f).closest(".popover");m||(a.$$phase?a.popover.cancel():a.$apply(function(){return a.popover.cancel()}));b.removeClass("in");setTimeout(function(){return b.hide()},
300);return!1})}}};e.$inject=["$injector"];h.directive("fbFormObjectEditable",e);h.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});e=function(c){return{restrict:"A",controller:"fbComponentController",link:function(a,b,d){var f,m,e;c.get("$builder");m=c.get("$drag");e=c.get("$parse");f=c.get("$compile");d=e(d.fbComponent)(a);a.copyObjectToScope(d);m.draggable($(b),{mode:"mirror",defer:!1,object:{componentName:d.name}});a=f(d.template)(a);return $(b).append(a)}}};e.$inject=["$injector"];h.directive("fbComponent",e);e=function(c){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},
template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object"></div>',controller:"fbFormController",link:function(a,b,d){b=c.get("$builder");return a.form=b.forms[d.fbForm]}}};e.$inject=["$injector"];h.directive("fbForm",e);e=function(c){return{restrict:"A",controller:"fbFormObjectController",link:function(a,b,d){var f,m,e;f=c.get("$builder");m=c.get("$compile");e=c.get("$parse");a.formObject=e(d.fbFormObject)(a);e=f.components[a.formObject.component];a.$on(f.broadcastChannel.updateInput,
function(){var b;return a.updateInput([null!=(b=a.inputText)?b:""])});e.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(b,d){var c,f;if(b!==d){c=[];for(f in a.inputArray)a.inputArray[f]&&c.push(a.options[f]);return a.updateInput(c)}},!0));a.$watch("inputText",function(b){return a.updateInput([b])});a.$watch(d.fbFormObject,function(){return a.copyObjectToScope(a.formObject)},!0);d=$(e.template);d.find("[ng-model='inputText']").attr({validator:"{{validation}}","validator-error":"{{errorMessage}}"});
m=m(d)(a);$(b).append(m);if(!e.arrayToText&&0<a.formObject.options.length)return a.inputText=a.formObject.options[0]}}};e.$inject=["$injector"];h.directive("fbFormObject",e)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var h,e,c,a=this;e=h=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return a.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(b){var d,c,e;a.mouseMoved=!1;e=a.hooks.down;for(c in e)d=e[c],d(b)});$(document).on("mousemove",function(b){var d,c,e;a.mouseMoved=!0;e=a.hooks.move;
for(c in e)d=e[c],d(b)});return $(document).on("mouseup",function(b){var d,c,e;e=a.hooks.up;for(c in e)d=e[c],d(b)})});this.currentId=0;this.getNewId=function(){return""+a.currentId++};this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,d,c,e,g){return-e*(d/=g)*(d-2)+c}})};this.setupProviders=function(a){h=a;return e=h.get("$rootScope")};this.isHover=function(a,d){var c,e,g,k,p,l,n;l=a.offset();n=d.offset();g=a.width();k=a.height();c=d.width();e=d.height();p={x:!1,
y:!1};p.x=l.left>n.left&&l.left<n.left+c;p.x=p.x||l.left+g>n.left&&l.left+g<n.left+c;if(!p)return!1;p.y=l.top>n.top&&l.top<n.top+e;p.y=p.y||l.top+k>n.top&&l.top+k<n.top+e;return p.x&&p.y};c=function(a,d){return setTimeout(function(){return d()},a)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(){a.autoScroll.scrolling=!0;return a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?
($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1},start:function(b){if(50>b.clientY){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else if(b.clientY>$(window).innerHeight()-50){if(a.autoScroll.up=!1,a.autoScroll.down=!0,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else return a.autoScroll.up=!1,a.autoScroll.down=!1},stop:function(){a.autoScroll.up=
!1;return a.autoScroll.down=!1}};this.dragMirrorMode=function(b,d,c){var e;null==d&&(d=!0);e={id:a.getNewId(),mode:"mirror",maternal:b[0],element:null,object:c};b.on("mousedown",function(c){var f;c.preventDefault();f=b.clone();e.element=f[0];f.addClass("fb-draggable form-horizontal prepare-dragging");a.hooks.move.drag=function(d,c){var g,q,h,r;if(f.hasClass("prepare-dragging")&&(f.css({width:b.width(),height:b.height()}),f.removeClass("prepare-dragging"),f.addClass("dragging"),c))return;f.offset({left:d.pageX-
f.width()/2,top:d.pageY-f.height()/2});a.autoScroll.start(d);h=a.data.droppables;r=[];for(q in h)g=h[q],a.isHover(f,$(g.element))?r.push(g.move(d,e)):r.push(g.out(d,e));return r};a.hooks.up.drag=function(b){var d,c,g,h;h=a.data.droppables;for(c in h)d=h[c],g=a.isHover(f,$(d.element)),d.up(b,g,e);delete a.hooks.move.drag;delete a.hooks.up.drag;e.element=null;f.remove();return a.autoScroll.stop()};$("body").append(f);if(!d)return a.hooks.move.drag(c,d)});return e};this.dragDragMode=function(b,d,c){var e;
null==d&&(d=!0);e={id:a.getNewId(),mode:"drag",maternal:null,element:b[0],object:c};b.addClass("fb-draggable");b.on("mousedown",function(c){c.preventDefault();if(!b.hasClass("dragging")&&(b.addClass("prepare-dragging"),a.hooks.move.drag=function(d,c){var f,g,h;if(b.hasClass("prepare-dragging")&&(b.css({width:b.width(),height:b.height()}),b.removeClass("prepare-dragging"),b.addClass("dragging"),c))return;b.offset({left:d.pageX-b.width()/2,top:d.pageY-b.height()/2});a.autoScroll.start(d);h=a.data.droppables;
for(g in h)f=h[g],a.isHover(b,$(f.element))?f.move(d,e):f.out(d,e)},a.hooks.up.drag=function(d){var c,f,g,h;h=a.data.droppables;for(f in h)c=h[f],g=a.isHover(b,$(c.element)),c.up(d,g,e);delete a.hooks.move.drag;delete a.hooks.up.drag;b.css({width:"",height:"",left:"",top:""});b.removeClass("dragging defer-dragging");return a.autoScroll.stop()},!d))return a.hooks.move.drag(c,d)});return e};this.dropMode=function(b,d){return{id:a.getNewId(),element:b[0],move:function(a,b){return e.$apply(function(){return"function"===
typeof d.move?d.move(a,b):void 0})},up:function(a,b,c){return e.$apply(function(){return"function"===typeof d.up?d.up(a,b,c):void 0})},out:function(a,b){return e.$apply(function(){return"function"===typeof d.out?d.out(a,b):void 0})}}};this.draggable=function(b,d){var c,e,g,k;null==d&&(d={});e=[];if("mirror"===d.mode)for(g=0,k=b.length;g<k;g++)c=b[g],c=a.dragMirrorMode($(c),d.defer,d.object),e.push(c.id),a.data.draggables[c.id]=c;else for(g=0,k=b.length;g<k;g++)c=b[g],c=a.dragDragMode($(c),d.defer,
d.object),e.push(c.id),a.data.draggables[c.id]=c;return e};this.droppable=function(b,c){var e,h,g,k;null==c&&(c={});h=[];g=0;for(k=b.length;g<k;g++)e=b[g],e=a.dropMode($(e),c),h.push(e),a.data.droppables[e.id]=e;return h};this.get=function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var h=[].indexOf||function(e){for(var c=0,a=this.length;c<a;c++)if(c in this&&this[c]===e)return c;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var e=this;this.version="0.0.0";this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substr(1)};this.getNewGuid=function(){return""+this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+
"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()};this.getEmptyGuid=function(){return"00000000-0000-0000-0000-000000000000"};this.convertComponent=function(c,a){var b,d,e,h,g,k,p,l,n,q,s,r;b={name:c,group:null!=(d=a.group)?d:"Default",label:null!=(e=a.label)?e:"",description:null!=(g=a.description)?g:"",placeholder:null!=(k=a.placeholder)?k:"",editable:null!=(p=a.editable)?p:!0,required:null!=(l=a.required)?l:!1,validation:null!=(n=a.validation)?n:"/.*/",validationOptions:null!=(q=a.validationOptions)?
q:[],errorMessage:null!=(s=a.errorMessage)?s:"",options:null!=(r=a.options)?r:[],arrayToText:null!=(h=a.arrayToText)?h:!1,template:a.template,popoverTemplate:a.popoverTemplate};b.template||console.error("The template is empty.");b.popoverTemplate||console.error("The popoverTemplate is empty.");return b};this.convertFormObject=function(c,a){var b,d,e,h,g,k,p,l,n,q,s;null==a&&(a={});b=this.components[a.component];if(null==b)throw"The component "+a.component+" was not registered.";return{id:null!=(d=
a.id)?d:this.getNewGuid(),component:a.component,editable:null!=(e=a.editable)?e:b.editable,index:null!=(h=a.index)?h:0,label:null!=(g=a.label)?g:b.label,description:null!=(k=a.description)?k:b.description,placeholder:null!=(p=a.placeholder)?p:b.placeholder,options:null!=(l=a.options)?l:b.options,required:null!=(n=a.required)?n:b.required,validation:null!=(q=a.validation)?q:b.validation,errorMessage:null!=(s=a.errorMessage)?s:b.errorMessage}};this.reindexFormObject=function(c){var a,b,d;c=e.forms[c];
a=b=0;for(d=c.length-1;b<=d;a=b+=1)c[a].index=a};this.registerComponent=function(c,a){var b,d;null==a&&(a={});null==e.components[c]?(b=e.convertComponent(c,a),e.components[c]=b,(d=b.group,0>h.call(e.groups,d))&&e.groups.push(b.group)):console.error("The component "+c+" was registered.")};this.addFormObject=function(c,a){var b;null==a&&(a={});null==(b=e.forms)[c]&&(b[c]=[]);return e.insertFormObject(c,e.forms[c].length,a)};this.insertFormObject=function(c,a,b){var d;null==b&&(b={});null==(d=e.forms)[c]&&
(d[c]=[]);a>e.forms[c].length?a=e.forms[c].length:0>a&&(a=0);e.forms[c].splice(a,0,e.convertFormObject(c,b));return e.reindexFormObject(c)};this.removeFormObject=function(c,a){e.forms[c].splice(a,1);return e.reindexFormObject(c)};this.updateFormObjectIndex=function(c,a,b){var d;if(a!==b)return d=e.forms[c],a=d.splice(a,1)[0],d.splice(b,0,a),e.reindexFormObject(c)};this.$get=this.get=function(){return{version:this.version,components:this.components,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,
registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,updateFormObjectIndex:this.updateFormObjectIndex}}})}).call(this);
